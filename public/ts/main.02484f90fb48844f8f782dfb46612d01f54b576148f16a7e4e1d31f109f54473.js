(()=>{var v=class e{galleryUID;items=[];constructor(t,n=1){if(window.PhotoSwipe==null||window.PhotoSwipeUI_Default==null){console.error("PhotoSwipe lib not loaded.");return}this.galleryUID=n,e.createGallery(t),this.loadItems(t),this.bindClick()}loadItems(t){this.items=[];let n=t.querySelectorAll("figure.gallery-image");for(let o of n){let s=o.querySelector("figcaption"),i=o.querySelector("img"),r={w:parseInt(i.getAttribute("width")),h:parseInt(i.getAttribute("height")),src:i.src,msrc:i.getAttribute("data-thumb")||i.src,el:o};s&&(r.title=s.innerHTML),this.items.push(r)}}static createGallery(t){let n=t.querySelectorAll("img.gallery-image");for(let i of Array.from(n)){let r=i.closest("p");if(!r||!t.contains(r)||(r.textContent.trim()==""&&r.classList.add("no-text"),!r.classList.contains("no-text")))continue;let u=i.parentElement.tagName=="A",c=i,d=document.createElement("figure");if(d.style.setProperty("flex-grow",i.getAttribute("data-flex-grow")||"1"),d.style.setProperty("flex-basis",i.getAttribute("data-flex-basis")||"0"),u&&(c=i.parentElement),c.parentElement.insertBefore(d,c),d.appendChild(c),i.hasAttribute("alt")){let l=document.createElement("figcaption");l.innerText=i.getAttribute("alt"),d.appendChild(l)}if(!u){d.className="gallery-image";let l=document.createElement("a");l.href=i.src,l.setAttribute("target","_blank"),i.parentNode.insertBefore(l,i),l.appendChild(i)}}let o=t.querySelectorAll("figure.gallery-image"),s=[];for(let i of o)s.length?i.previousElementSibling===s[s.length-1]?s.push(i):s.length&&(e.wrap(s),s=[i]):s=[i];s.length>0&&e.wrap(s)}static wrap(t){let n=document.createElement("div");n.className="gallery";let o=t[0].parentNode,s=t[0];o.insertBefore(n,s);for(let i of t)n.appendChild(i)}open(t){let n=document.querySelector(".pswp");new window.PhotoSwipe(n,window.PhotoSwipeUI_Default,this.items,{index:t,galleryUID:this.galleryUID,getThumbBoundsFn:s=>{let i=this.items[s].el.getElementsByTagName("img")[0],r=window.pageYOffset||document.documentElement.scrollTop,a=i.getBoundingClientRect();return{x:a.left,y:a.top+r,w:a.width}}}).init()}bindClick(){for(let[t,n]of this.items.entries())n.el.querySelector("a").addEventListener("click",s=>{s.preventDefault(),this.open(t)})}},E=v;var h={};if(localStorage.hasOwnProperty("StackColorsCache"))try{h=JSON.parse(localStorage.getItem("StackColorsCache"))}catch{h={}}async function L(e,t,n){if(!e)return await Vibrant.from(n).getPalette();if(!h.hasOwnProperty(e)||h[e].hash!==t){let o=await Vibrant.from(n).getPalette();h[e]={hash:t,Vibrant:{hex:o.Vibrant.hex,rgb:o.Vibrant.rgb,bodyTextColor:o.Vibrant.bodyTextColor},DarkMuted:{hex:o.DarkMuted.hex,rgb:o.DarkMuted.rgb,bodyTextColor:o.DarkMuted.bodyTextColor}},localStorage.setItem("StackColorsCache",JSON.stringify(h))}return h[e]}var O=(e,t=500)=>{e.classList.add("transiting"),e.style.transitionProperty="height, margin, padding",e.style.transitionDuration=t+"ms",e.style.height=e.offsetHeight+"px",e.offsetHeight,e.style.overflow="hidden",e.style.height="0",e.style.paddingTop="0",e.style.paddingBottom="0",e.style.marginTop="0",e.style.marginBottom="0",window.setTimeout(()=>{e.classList.remove("show"),e.style.removeProperty("height"),e.style.removeProperty("padding-top"),e.style.removeProperty("padding-bottom"),e.style.removeProperty("margin-top"),e.style.removeProperty("margin-bottom"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property"),e.classList.remove("transiting")},t)},U=(e,t=500)=>{e.classList.add("transiting"),e.style.removeProperty("display"),e.classList.add("show");let n=e.offsetHeight;e.style.overflow="hidden",e.style.height="0",e.style.paddingTop="0",e.style.paddingBottom="0",e.style.marginTop="0",e.style.marginBottom="0",e.offsetHeight,e.style.transitionProperty="height, margin, padding",e.style.transitionDuration=t+"ms",e.style.height=n+"px",e.style.removeProperty("padding-top"),e.style.removeProperty("padding-bottom"),e.style.removeProperty("margin-top"),e.style.removeProperty("margin-bottom"),window.setTimeout(()=>{e.style.removeProperty("height"),e.style.removeProperty("overflow"),e.style.removeProperty("transition-duration"),e.style.removeProperty("transition-property"),e.classList.remove("transiting")},t)},V=(e,t=500)=>window.getComputedStyle(e).display==="none"?U(e,t):O(e,t);function A(){let e=document.getElementById("toggle-menu");e&&e.addEventListener("click",()=>{document.getElementById("main-menu").classList.contains("transiting")||(document.body.classList.toggle("show-menu"),V(document.getElementById("main-menu"),300),e.classList.toggle("is-active"))})}function R(e,t,n){var o=document.createElement(e);for(let s in t)if(s&&t.hasOwnProperty(s)){let i=t[s];s=="dangerouslySetInnerHTML"?o.innerHTML=i.__html:i===!0?o.setAttribute(s,s):i!==!1&&i!=null&&o.setAttribute(s,i.toString())}for(let s=2;s<arguments.length;s++){let i=arguments[s];i&&o.appendChild(i.nodeType==null?document.createTextNode(i.toString()):i)}return o}var k=R;var b=class{localStorageKey="StackColorScheme";currentScheme;systemPreferScheme;constructor(t){this.bindMatchMedia(),this.currentScheme=this.getSavedScheme(),window.matchMedia("(prefers-color-scheme: dark)").matches===!0?this.systemPreferScheme="dark":this.systemPreferScheme="light",this.dispatchEvent(document.documentElement.dataset.scheme),t&&this.bindClick(t),document.body.style.transition==""&&document.body.style.setProperty("transition","background-color .3s ease")}saveScheme(){localStorage.setItem(this.localStorageKey,this.currentScheme)}bindClick(t){t.addEventListener("click",n=>{this.isDark()?this.currentScheme="light":this.currentScheme="dark",this.setBodyClass(),this.currentScheme==this.systemPreferScheme&&(this.currentScheme="auto"),this.saveScheme()})}isDark(){return this.currentScheme=="dark"||this.currentScheme=="auto"&&this.systemPreferScheme=="dark"}dispatchEvent(t){let n=new CustomEvent("onColorSchemeChange",{detail:t});window.dispatchEvent(n)}setBodyClass(){this.isDark()?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light",this.dispatchEvent(document.documentElement.dataset.scheme)}getSavedScheme(){let t=localStorage.getItem(this.localStorageKey);return t=="light"||t=="dark"||t=="auto"?t:"auto"}bindMatchMedia(){window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",t=>{t.matches?this.systemPreferScheme="dark":this.systemPreferScheme="light",this.setBodyClass()})}},T=b;function y(e){let t;return()=>{t&&window.cancelAnimationFrame(t),t=window.requestAnimationFrame(()=>e())}}var $=".article-content h1[id], .article-content h2[id], .article-content h3[id], .article-content h4[id], .article-content h5[id], .article-content h6[id]",x="#TableOfContents",M="#TableOfContents li",I="active-class";function F(e,t){let n=e.querySelector("a").offsetHeight,o=e.offsetTop-t.offsetHeight/2+n/2-t.offsetTop;o<0&&(o=0),t.scrollTo({top:o,behavior:"smooth"})}function Q(e){let t={};return e.forEach(n=>{let s=n.querySelector("a").getAttribute("href");s.startsWith("#")&&(t[s.slice(1)]=n)}),t}function C(e){let t=[];return e.forEach(n=>{t.push({id:n.id,offset:n.offsetTop})}),t.sort((n,o)=>n.offset-o.offset),t}function B(){let e=document.querySelectorAll($);if(!e){console.warn("No header matched query",e);return}let t=document.querySelector(x);if(!t){console.warn("No toc matched query",x);return}let n=document.querySelectorAll(M);if(!n){console.warn("No navigation matched query",M);return}let o=C(e),s=!1;t.addEventListener("mouseenter",y(()=>s=!0)),t.addEventListener("mouseleave",y(()=>s=!1));let i,r=Q(n);function a(){let c=document.documentElement.scrollTop||document.body.scrollTop,d;o.forEach(p=>{c>=p.offset-20&&(d=document.getElementById(p.id))});let l;d&&(l=r[d.id]),d&&!l?console.debug("No link found for section",d):l!==i&&(i&&i.classList.remove(I),l&&(l.classList.add(I),s||F(l,t)),i=l)}window.addEventListener("scroll",y(a));function u(){o=C(e),a()}window.addEventListener("resize",y(u))}var W="a[href]";function P(){document.querySelectorAll(W).forEach(e=>{e.getAttribute("href").startsWith("#")&&e.addEventListener("click",n=>{n.preventDefault();let o=decodeURI(e.getAttribute("href").substring(1)),s=document.getElementById(o),i=s.getBoundingClientRect().top-document.documentElement.getBoundingClientRect().top;window.history.pushState({},"",e.getAttribute("href")),scrollTo({top:i,behavior:"smooth"})})})}var S=class{localStorageKey="StackAdminAuth";attemptsKey="StackAuthAttempts";timestampKey="StackAuthTimestamp";currentStatus;config;constructor(t){this.config={adminPassword:"admit",sessionTimeout:24*60*60*1e3,maxLoginAttempts:5,...t},this.currentStatus=this.getSavedAuthStatus(),this.cleanupExpiredSession(),this.dispatchAuthEvent(this.currentStatus)}authenticate(t){return this.isBlocked()?(this.dispatchAuthEvent("blocked"),!1):t===this.config.adminPassword?(this.currentStatus="authenticated",this.saveAuthStatus(),this.clearLoginAttempts(),this.dispatchAuthEvent("authenticated"),!0):(this.incrementLoginAttempts(),this.dispatchAuthEvent("failed"),!1)}logout(){this.currentStatus="guest",this.clearAuthData(),this.dispatchAuthEvent("guest")}isAuthenticated(){return this.isSessionExpired()?(this.logout(),!1):this.currentStatus==="authenticated"}isAdmin(){return this.isAuthenticated()}getStatus(){return this.currentStatus}isBlocked(){return this.getLoginAttempts()>=this.config.maxLoginAttempts}getRemainingAttempts(){let t=this.getLoginAttempts();return Math.max(0,this.config.maxLoginAttempts-t)}resetLoginAttempts(){this.clearLoginAttempts()}saveAuthStatus(){localStorage.setItem(this.localStorageKey,this.currentStatus),localStorage.setItem(this.timestampKey,Date.now().toString())}getSavedAuthStatus(){return localStorage.getItem(this.localStorageKey)==="authenticated"?"authenticated":"guest"}isSessionExpired(){let t=localStorage.getItem(this.timestampKey);if(!t)return!0;let n=parseInt(t);return Date.now()-n>this.config.sessionTimeout}cleanupExpiredSession(){this.isSessionExpired()&&(this.clearAuthData(),this.currentStatus="guest")}clearAuthData(){localStorage.removeItem(this.localStorageKey),localStorage.removeItem(this.timestampKey)}getLoginAttempts(){let t=localStorage.getItem(this.attemptsKey);return t?parseInt(t):0}incrementLoginAttempts(){let t=this.getLoginAttempts()+1;localStorage.setItem(this.attemptsKey,t.toString())}clearLoginAttempts(){localStorage.removeItem(this.attemptsKey)}dispatchAuthEvent(t){let n=new CustomEvent("onAuthStatusChange",{detail:{status:t,isAuthenticated:this.isAuthenticated(),isAdmin:this.isAdmin(),remainingAttempts:this.getRemainingAttempts()}});window.dispatchEvent(n)}},m={toggleAdminElements:e=>{let t=document.querySelectorAll("[data-admin-only]"),n=document.querySelectorAll("[data-guest-only]");t.forEach(o=>{o.style.display=e?"":"none"}),n.forEach(o=>{o.style.display=e?"none":""})},updateBodyClass:e=>{e?(document.body.classList.add("admin-mode"),document.body.classList.remove("guest-mode")):(document.body.classList.add("guest-mode"),document.body.classList.remove("admin-mode"))},createLoginModal:()=>`
            <div id="admin-login-modal" class="admin-modal" style="display: none;">
                <div class="admin-modal-content">
                    <div class="admin-modal-header">
                        <h3>
                            <svg class="admin-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M9 12l2 2 4-4"></path>
                                <path d="M21 12c-1 0-3-1-3-3s2-3 3-3 3 1 3 3-2 3-3 3"></path>
                                <path d="M3 12c1 0 3-1 3-3s-2-3-3-3-3 1-3 3 2 3 3 3"></path>
                                <path d="M12 3c0 1-1 3-3 3s-3-2-3-3 1-3 3-3 3 2 3 3"></path>
                                <path d="M12 21c0-1 1-3 3-3s3 2 3 3-1 3-3 3-3-2-3-3"></path>
                            </svg>
                            \u7BA1\u7406\u5458\u767B\u5F55
                        </h3>
                        <button class="admin-modal-close" id="admin-modal-close" type="button" aria-label="\u5173\u95ED\u767B\u5F55\u7A97\u53E3">
                            <svg class="admin-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                    <div class="admin-modal-body">
                        <form id="admin-login-form" novalidate>
                            <div class="admin-form-group">
                                <label for="admin-password">
                                    <svg class="admin-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                                        <circle cx="12" cy="16" r="1"></circle>
                                        <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
                                    </svg>
                                    \u7BA1\u7406\u5458\u5BC6\u7801
                                </label>
                                <input
                                    type="password"
                                    id="admin-password"
                                    name="password"
                                    placeholder="\u8BF7\u8F93\u5165\u7BA1\u7406\u5458\u5BC6\u7801"
                                    autocomplete="current-password"
                                    required
                                    aria-describedby="admin-login-error admin-login-attempts"
                                >
                            </div>
                            <div class="admin-form-actions">
                                <button type="submit" id="admin-login-btn" class="admin-btn admin-btn-primary">
                                    <svg class="admin-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"></path>
                                        <polyline points="10,17 15,12 10,7"></polyline>
                                        <line x1="15" y1="12" x2="3" y2="12"></line>
                                    </svg>
                                    \u767B\u5F55
                                </button>
                                <button type="button" id="admin-cancel-btn" class="admin-btn admin-btn-secondary">
                                    <svg class="admin-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                        <line x1="18" y1="6" x2="6" y2="18"></line>
                                        <line x1="6" y1="6" x2="18" y2="18"></line>
                                    </svg>
                                    \u53D6\u6D88
                                </button>
                            </div>
                            <div id="admin-login-error" class="admin-error" style="display: none;" role="alert" aria-live="polite">
                                <!-- Error message will be inserted here -->
                            </div>
                            <div id="admin-login-attempts" class="admin-info" style="display: none;" role="status" aria-live="polite">
                                <!-- Attempts info will be inserted here -->
                            </div>
                        </form>
                        <div class="admin-login-help">
                            <p class="admin-help-text">
                                <svg class="admin-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"></circle>
                                    <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
                                    <line x1="12" y1="17" x2="12.01" y2="17"></line>
                                </svg>
                                \u63D0\u793A\uFF1A\u4F7F\u7528\u5FEB\u6377\u952E <kbd>Ctrl + Alt + A</kbd> \u53EF\u5FEB\u901F\u6253\u5F00\u767B\u5F55\u7A97\u53E3
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        `,showLoginModal:()=>{let e=document.getElementById("admin-login-modal");e&&(e.style.display="flex",setTimeout(()=>{let t=document.getElementById("admin-password");t&&t.focus()},100))},hideLoginModal:()=>{let e=document.getElementById("admin-login-modal");if(e){e.style.display="none";let t=document.getElementById("admin-login-form");t&&t.reset();let n=document.getElementById("admin-login-error"),o=document.getElementById("admin-login-attempts");n&&(n.style.display="none"),o&&(o.style.display="none")}},showLoginError:e=>{let t=document.getElementById("admin-login-error");t&&(t.textContent=e,t.style.display="block")},showAttemptsInfo:e=>{let t=document.getElementById("admin-login-attempts");t&&(t.textContent=`\u5269\u4F59\u5C1D\u8BD5\u6B21\u6570: ${e}`,t.style.display="block")},setLoginButtonLoading:e=>{let t=document.getElementById("admin-login-btn");t&&(e?(t.disabled=!0,t.classList.add("loading")):(t.disabled=!1,t.classList.remove("loading")))},clearMessages:()=>{let e=document.getElementById("admin-login-error"),t=document.getElementById("admin-login-attempts");e&&(e.style.display="none"),t&&(t.style.display="none")},validatePassword:e=>e?e.length<1?{valid:!1,message:"\u5BC6\u7801\u4E0D\u80FD\u4E3A\u7A7A"}:{valid:!0}:{valid:!1,message:"\u8BF7\u8F93\u5165\u5BC6\u7801"}},H=S;var f,w={init:()=>{f=new H,window.addEventListener("onAuthStatusChange",r=>{let{status:a,isAuthenticated:u,isAdmin:c,remainingAttempts:d}=r.detail;switch(m.toggleAdminElements(c),m.updateBodyClass(c),a){case"authenticated":m.hideLoginModal(),console.log("Admin authenticated successfully");break;case"failed":m.showLoginError("\u5BC6\u7801\u9519\u8BEF"),d>0&&m.showAttemptsInfo(d);break;case"blocked":m.showLoginError("\u767B\u5F55\u5C1D\u8BD5\u6B21\u6570\u8FC7\u591A\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5");break;case"guest":console.log("User logged out or session expired");break}});let e=m.createLoginModal();document.body.insertAdjacentHTML("beforeend",e),w.bindAuthEvents(),A();let t=document.querySelector(".article-content");t&&(new E(t),P(),B());let n=document.querySelector(".article-list--tile");n&&new IntersectionObserver(async(a,u)=>{a.forEach(c=>{if(!c.isIntersecting)return;u.unobserve(c.target),c.target.querySelectorAll("article.has-image").forEach(async l=>{let p=l.querySelector("img"),D=p.src,q=p.getAttribute("data-key"),N=p.getAttribute("data-hash"),K=l.querySelector(".article-details"),g=await L(q,N,D);K.style.background=`
                        linear-gradient(0deg, 
                            rgba(${g.DarkMuted.rgb[0]}, ${g.DarkMuted.rgb[1]}, ${g.DarkMuted.rgb[2]}, 0.5) 0%, 
                            rgba(${g.Vibrant.rgb[0]}, ${g.Vibrant.rgb[1]}, ${g.Vibrant.rgb[2]}, 0.75) 100%)`})})}).observe(n);let o=document.querySelectorAll(".article-content div.highlight"),s="Copy",i="Copied!";o.forEach(r=>{let a=document.createElement("button");a.innerHTML=s,a.classList.add("copyCodeButton"),r.appendChild(a);let u=r.querySelector("code[data-lang]");u&&a.addEventListener("click",()=>{navigator.clipboard.writeText(u.textContent).then(()=>{a.textContent=i,setTimeout(()=>{a.textContent=s},1e3)}).catch(c=>{alert(c),console.log("Something went wrong",c)})})}),new T(document.getElementById("dark-mode-toggle"))},bindAuthEvents:()=>{let e=document.getElementById("admin-login-form");e&&e.addEventListener("submit",i=>{i.preventDefault();let r=document.getElementById("admin-password");r&&f.authenticate(r.value)});let t=document.getElementById("admin-modal-close"),n=document.getElementById("admin-cancel-btn");t&&t.addEventListener("click",()=>{m.hideLoginModal()}),n&&n.addEventListener("click",()=>{m.hideLoginModal()});let o=document.getElementById("admin-login-modal");o&&o.addEventListener("click",i=>{i.target===o&&m.hideLoginModal()}),document.addEventListener("keydown",i=>{i.key==="Escape"&&m.hideLoginModal()});let s=document.getElementById("admin-panel-toggle");s&&s.addEventListener("click",i=>{i.preventDefault(),console.log("Admin panel toggle clicked - functionality to be implemented")})},getAuth:()=>f,showLogin:()=>{m.showLoginModal()},logout:()=>{f&&f.logout()}};window.addEventListener("load",()=>{setTimeout(function(){w.init()},0)});window.Stack=w;window.createElement=k;window.StackAuth=f;})();
/*!
*   Hugo Theme Stack - Authentication Module
*
*   @author: Emma (Product Manager)
*   @project: Hugo Blog Admin System
*   @description: Admin authentication and permission management
*/
/*!
*   Hugo Theme Stack - Extended with Admin Authentication
*
*   @author: Jimmy Cai (Original), Emma (Admin Extension)
*   @website: https://jimmycai.com
*   @link: https://github.com/CaiJimmy/hugo-theme-stack
*/
